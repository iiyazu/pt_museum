<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iiyatsu.mapper.ArtifactMapper">

    <!--
        该SQL语句用于根据ArtifaQueryParam中的参数进行动态查询。
        - 根据 age 进行大于等于（>=）查询。
        - 根据 name 进行模糊查询（LIKE）。
        - 结合PageHelper使用，不再需要手动编写分页SQL（LIMIT和OFFSET）。
    -->
    <select id="selectByParam" resultType="com.iiyatsu.pojo.artifact.Artifact">
        SELECT
            id,
            name,
            image,
            age
        FROM
            artifact
        <where>
            <if test="age != null">
                <!-- 查询age大于等于指定值的文物 -->
                AND age >= #{age}
            </if>
            <if test="name != null and name != ''">
                <!-- 根据名称进行模糊查询 -->
                AND name LIKE concat('%', #{name}, '%')
            </if>
        </where>
        ORDER BY id DESC
    </select>

    <delete id="deleteBatch">
        DELETE FROM artifact
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!--
        根据ID更新Artifact的非空字段
        @param artifact 包含要更新的字段和id的Artifact对象
    -->
    <update id="updateById">
        UPDATE artifact <!-- 请替换为你的实际表名 -->
        <set> <!-- <set> 标签会自动处理 SET 子句和末尾的逗号 -->
            <!-- 只有当字段不为 null 时，才添加到 SET 子句中 -->
            <if test="name != null">name = #{name},</if>
            <if test="image != null">image = #{image},</if>
            <if test="description != null">description = #{description},</if>
            <if test="age != null">age = #{age},</if>
            <!-- 如果有更多字段，继续添加 <if> 判断 -->
        </set>
        WHERE id = #{id} <!-- 主键ID必须存在，通常由调用方保证 -->
    </update>

</mapper>